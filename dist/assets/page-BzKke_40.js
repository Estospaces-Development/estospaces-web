import{u as z,h as S,r as l,j as e,w as $,a as L,x as v,as as E}from"./index-D9fuy-ar.js";import{b as C}from"./bookingsService-ibh1P8en.js";import{A as B}from"./arrow-left-BaPK0xsr.js";import{P as F}from"./plus-wruqDZww.js";import{C as M}from"./clock-D-pnzsNv.js";function U(){const n=z(),{user:c}=S(),[x,g]=l.useState([]),[P,p]=l.useState(!0),[o,V]=l.useState("all"),m=l.useCallback(async()=>{p(!0);try{const t=await C.getViewings();if(t.data){const s=t.data.map(a=>{var r,d,i,u,b,y,f,j,N,w,k;return{...a,date:((r=a.scheduled_at)==null?void 0:r.split("T")[0])||a.scheduled_at,time:((i=(d=a.scheduled_at)==null?void 0:d.split("T")[1])==null?void 0:i.substring(0,5))||"",propertyImage:((b=(u=a.property)==null?void 0:u.image_urls)==null?void 0:b[0])||"https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800",propertyTitle:((y=a.property)==null?void 0:y.title)||"Property",propertyAddress:((f=a.property)==null?void 0:f.address_line_1)||"Address not available",propertyPrice:((j=a.property)==null?void 0:j.price)||0,listingType:((N=a.property)==null?void 0:N.listing_type)||"sale",agentName:((w=a.agent)==null?void 0:w.name)||"Agent",agentPhone:((k=a.agent)==null?void 0:k.phone)||""}});g(s)}}catch(t){console.error("[Viewings] Error fetching viewings:",t)}finally{p(!1)}},[]);l.useEffect(()=>{m()},[m]);const h=x.filter(t=>{if(!t.date)return!0;const s=new Date(t.date),a=new Date;switch(a.setHours(0,0,0,0),o){case"upcoming":return s>=a&&t.status!=="cancelled";case"past":return s<a||t.status==="completed";case"cancelled":return t.status==="cancelled";default:return!0}}),A=async t=>{if(window.confirm("Are you sure you want to cancel this viewing?"))try{await C.cancelViewing(t),g(a=>a.map(r=>r.id===t?{...r,status:"cancelled"}:r));const s=x.find(a=>a.id===t);s&&await E((c==null?void 0:c.id)||"mock-user-id",s.propertyTitle,s.property_id,s.date,"Cancelled by you")}catch(s){console.error("Error cancelling viewing:",s),alert("Failed to cancel viewing. Please try again.")}},T=t=>{const s={pending:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-800 dark:text-yellow-400",label:"Pending"},confirmed:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-800 dark:text-green-400",label:"Confirmed"},cancelled:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-800 dark:text-red-400",label:"Cancelled"},completed:{bg:"bg-blue-100 dark:bg-blue-900/30",text:"text-blue-800 dark:text-blue-400",label:"Completed"},rescheduled:{bg:"bg-purple-100 dark:bg-purple-900/30",text:"text-purple-800 dark:text-purple-400",label:"Rescheduled"}},a=s[t]||s.pending;return e.jsx("span",{className:`px-2.5 py-1 text-xs font-bold rounded-lg shadow-sm ${a.bg} ${a.text}`,children:a.label})},_=t=>new Date(t).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),D=t=>{if(!t)return"";const[s,a]=t.split(":"),r=parseInt(s),d=r>=12?"PM":"AM";return`${r%12||12}:${a} ${d}`};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pb-12",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>n("/user/dashboard"),className:"mb-6 flex items-center gap-2 text-gray-500 hover:text-orange-500 transition-colors group",children:[e.jsx(B,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Dashboard"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Your Viewings"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your appointments with property agents"})]}),e.jsxs("button",{onClick:()=>n("/user/dashboard/discover"),className:"flex items-center gap-2 px-6 py-3 bg-orange-500 text-white rounded-xl font-bold hover:bg-orange-600 shadow-lg shadow-orange-500/20 transition-all active:scale-95",children:[e.jsx(F,{size:20}),"Book New Viewing"]})]})]}),e.jsx("div",{className:"flex gap-2 mb-8 overflow-x-auto pb-2 scrollbar-hide",children:["all","upcoming","past","cancelled"].map(t=>e.jsxs("button",{onClick:()=>V(t),className:`px-5 py-2.5 rounded-xl font-bold text-sm whitespace-nowrap transition-all ${o===t?"bg-orange-500 text-white shadow-md":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 shadow-sm"}`,children:[t.charAt(0).toUpperCase()+t.slice(1)," Viewings"]},t))}),P?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 bg-white dark:bg-gray-800 rounded-3xl shadow-sm",children:[e.jsx($,{size:48,className:"animate-spin text-orange-500 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium tracking-wide",children:"Fetching your appointments..."})]}):h.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-6",children:h.map(t=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm overflow-hidden group hover:shadow-xl transition-all duration-300",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"md:w-64 h-48 md:h-auto relative overflow-hidden",children:[e.jsx("img",{src:t.propertyImage,alt:t.propertyTitle,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),e.jsx("div",{className:"absolute top-4 left-4",children:T(t.status)})]}),e.jsxs("div",{className:"flex-1 p-6 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white group-hover:text-orange-500 transition-colors line-clamp-1",children:t.propertyTitle}),t.propertyPrice&&e.jsxs("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["Â£",t.propertyPrice.toLocaleString(),e.jsx("span",{className:"text-sm text-gray-500 font-normal",children:t.listingType==="rent"?"/mo":""})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-6",children:[e.jsx(L,{size:16,className:"text-orange-500"}),e.jsx("span",{className:"line-clamp-1",children:t.propertyAddress})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 dark:bg-gray-900/50 p-3 rounded-xl",children:[e.jsx(v,{size:20,className:"text-orange-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-gray-400 font-bold uppercase tracking-wider",children:"Date"}),e.jsx("span",{className:"font-bold text-gray-700 dark:text-white",children:_(t.date)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 dark:bg-gray-900/50 p-3 rounded-xl",children:[e.jsx(M,{size:20,className:"text-orange-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-gray-400 font-bold uppercase tracking-wider",children:"Time"}),e.jsx("span",{className:"font-bold text-gray-700 dark:text-white",children:D(t.time)})]})]})]})]}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row items-center justify-between gap-4 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 dark:bg-orange-900/20 rounded-full flex items-center justify-center font-bold text-orange-600",children:t.agentName.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-gray-900 dark:text-white",children:t.agentName}),e.jsx("p",{className:"text-xs text-gray-500",children:t.agentPhone})]})]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>n(`/user/dashboard/property/${t.property_id}`),className:"flex-1 sm:flex-none px-4 py-2 text-sm font-bold text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 rounded-lg transition-colors",children:"View Listing"}),(t.status==="pending"||t.status==="confirmed")&&e.jsx("button",{onClick:()=>A(t.id),className:"flex-1 sm:flex-none px-4 py-2 text-sm font-bold text-red-600 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 rounded-lg transition-colors",children:"Cancel Appointment"})]})]})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-20 bg-white dark:bg-gray-800 rounded-3xl shadow-sm",children:[e.jsx("div",{className:"inline-flex items-center justify-center p-6 bg-gray-50 dark:bg-gray-700 rounded-full mb-6",children:e.jsx(v,{className:"text-gray-300",size:48})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Nothing to see here"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-2 max-w-sm mx-auto",children:["You don't have any ",o==="all"?"":o," viewings scheduled. Start exploring properties to book your first appointment."]}),e.jsx("button",{onClick:()=>n("/user/dashboard/discover"),className:"mt-8 px-8 py-3 bg-orange-500 text-white rounded-xl font-bold hover:bg-orange-600 shadow-lg shadow-orange-500/20 transition-all",children:"Find Properties"})]})]})})}export{U as default};
//# sourceMappingURL=page-BzKke_40.js.map
