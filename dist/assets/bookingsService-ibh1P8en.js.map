{"version":3,"file":"bookingsService-ibh1P8en.js","sources":["../../src/services/bookingsService.ts"],"sourcesContent":["/**\r\n * Bookings Service\r\n * Fetches and manages bookings, viewings, and contracts from the booking-service backend\r\n */\r\n\r\nimport { apiFetch, getServiceUrl } from '@/lib/apiUtils';\r\n\r\nconst BOOKING_URL = () => getServiceUrl('booking');\r\n\r\n// ── Interfaces ──────────────────────────────────────────────────────────────\r\n\r\nexport interface Booking {\r\n    id: string;\r\n    property_id: string;\r\n    user_id: string;\r\n    manager_id: string;\r\n    check_in_date: string;\r\n    check_out_date: string;\r\n    guest_count: number;\r\n    total_amount: number;\r\n    currency: string;\r\n    status: 'pending' | 'confirmed' | 'cancelled' | 'completed';\r\n    created_at: string;\r\n}\r\n\r\nexport interface Viewing {\r\n    id: string;\r\n    property_id: string;\r\n    user_id: string;\r\n    scheduled_at: string;\r\n    duration_minutes: number;\r\n    viewing_type: 'in_person' | 'virtual';\r\n    status: 'pending' | 'confirmed' | 'cancelled' | 'completed' | 'rescheduled';\r\n    user_notes?: string;\r\n    manager_notes?: string;\r\n    created_at: string;\r\n    // UI-mapped fields\r\n    property?: {\r\n        title: string;\r\n        address_line_1: string;\r\n        price: number;\r\n        listing_type: string;\r\n        image_urls: string[];\r\n    };\r\n    agent?: {\r\n        name: string;\r\n        phone: string;\r\n    };\r\n}\r\n\r\nexport interface Contract {\r\n    id: string;\r\n    property_id: string;\r\n    user_id: string;\r\n    manager_id: string;\r\n    contract_type: 'rental' | 'purchase';\r\n    start_date: string;\r\n    end_date?: string;\r\n    monthly_rent?: number;\r\n    deposit_amount?: number;\r\n    contract_pdf_url?: string;\r\n    status: 'draft' | 'sent' | 'signed' | 'active' | 'expired' | 'terminated';\r\n    user_signed_at?: string;\r\n    created_at: string;\r\n}\r\n\r\nexport interface ContractTemplate {\r\n    id: string;\r\n    name: string;\r\n    description: string;\r\n    type: string;\r\n    date: string;\r\n    status: string;\r\n    isMandatory: boolean;\r\n}\r\n\r\n// ── API Functions ───────────────────────────────────────────────────────────\r\n\r\n/**\r\n * Get bookings for the current user\r\n */\r\nexport async function getBookings(): Promise<{ data: Booking[] }> {\r\n    return apiFetch<{ data: Booking[] }>(`${BOOKING_URL()}/api/v1/bookings`);\r\n}\r\n\r\n/**\r\n * Get viewings for the current user\r\n */\r\nexport async function getViewings(): Promise<{ data: Viewing[] }> {\r\n    // Note: In a real implementation, the backend would join property/agent data\r\n    // For now, we fetch the raw viewings\r\n    return apiFetch<{ data: Viewing[] }>(`${BOOKING_URL()}/api/v1/viewings`);\r\n}\r\n\r\n/**\r\n * Get contracts for the current user\r\n */\r\nexport async function getContracts(): Promise<{ data: Contract[] }> {\r\n    return apiFetch<{ data: Contract[] }>(`${BOOKING_URL()}/api/v1/contracts`);\r\n}\r\n\r\n/**\r\n * Cancel a viewing\r\n */\r\nexport async function cancelViewing(id: string): Promise<void> {\r\n    await apiFetch(`${BOOKING_URL()}/api/v1/viewings/${id}/cancel`, {\r\n        method: 'POST',\r\n    });\r\n}\r\n\r\n/**\r\n * Get contract templates (mandatory forms)\r\n */\r\nexport async function getContractTemplates(): Promise<{ data: ContractTemplate[] }> {\r\n    return apiFetch<{ data: ContractTemplate[] }>(`${BOOKING_URL()}/api/v1/contract-templates`);\r\n}\r\n\r\nexport const bookingsService = {\r\n    getBookings,\r\n    getViewings,\r\n    getContracts,\r\n    getContractTemplates,\r\n    cancelViewing,\r\n};\r\n"],"names":["BOOKING_URL","getServiceUrl","getBookings","apiFetch","getViewings","getContracts","cancelViewing","id","getContractTemplates","bookingsService"],"mappings":"iDAOA,MAAMA,EAAc,IAAMC,EAAc,SAAS,EA0EjD,eAAsBC,GAA4C,CAC9D,OAAOC,EAA8B,GAAGH,EAAA,CAAa,kBAAkB,CAC3E,CAKA,eAAsBI,GAA4C,CAG9D,OAAOD,EAA8B,GAAGH,EAAA,CAAa,kBAAkB,CAC3E,CAKA,eAAsBK,GAA8C,CAChE,OAAOF,EAA+B,GAAGH,EAAA,CAAa,mBAAmB,CAC7E,CAKA,eAAsBM,EAAcC,EAA2B,CAC3D,MAAMJ,EAAS,GAAGH,EAAA,CAAa,oBAAoBO,CAAE,UAAW,CAC5D,OAAQ,MAAA,CACX,CACL,CAKA,eAAsBC,GAA8D,CAChF,OAAOL,EAAuC,GAAGH,EAAA,CAAa,4BAA4B,CAC9F,CAEO,MAAMS,EAAkB,CAC3B,YAAAP,EACA,YAAAE,EACA,aAAAC,EACA,qBAAAG,EACA,cAAAF,CACJ"}