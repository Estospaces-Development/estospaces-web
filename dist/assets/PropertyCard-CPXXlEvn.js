import{c as Q,j as e,X,ap as K,u as Y,r as o,a2 as Z,h as ee,p as ae,a8 as se,a0 as te,q as le,w as ie,a3 as _,C as A,a as re}from"./index-D9fuy-ar.js";import{S as ne}from"./ShareModal-DEtDfKka.js";import{E as oe}from"./eye-Dzbd2rxv.js";import{B as de,a as ce,M as ge}from"./maximize-DMYfH0UC.js";import{S as me}from"./star-Xdww4Nds.js";import{S as xe}from"./share-2-HEVtKF6m.js";import"./twitter-D1XJVDGg.js";import"./message-circle-Bh_ZnSbQ.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],ue=Q("maximize-2",he),fe=({property:a,onClose:x})=>{const d=(a==null?void 0:a.virtual_tour_url)||"https://my.matterport.com/show/?m=JGPnGQ6wM5l&play=1";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fadeIn",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl w-full max-w-5xl h-[80vh] flex flex-col overflow-hidden shadow-2xl relative",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between bg-white dark:bg-gray-900",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),"3D Virtual Tour"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a==null?void 0:a.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>window.open(d,"_blank"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors hidden sm:block",title:"Open in new tab",children:e.jsx(ue,{size:20,className:"text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:e.jsx(X,{size:24,className:"text-gray-600 dark:text-gray-300"})})]})]}),e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-black relative group",children:[e.jsx("iframe",{src:d,className:"w-full h-full border-0",allow:"fullscreen",title:`Virtual Tour of ${a==null?void 0:a.title}`,loading:"lazy"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-4 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.jsx("p",{className:"text-white text-center text-sm font-medium",children:"Click and drag to look around • Use arrow keys to move"})})]})]})})},be=({property:a,onViewDetails:x,onClick:d})=>{var p,S,C,z;const I=Y(),[w,f]=o.useState(0),[L,v]=o.useState(!1),[M,j]=o.useState(!1),[b,y]=o.useState(!1),[c,N]=o.useState(""),[T,g]=o.useState(!1),{toggleProperty:$,isPropertySaved:F}=Z(),{user:B}=ee(),{incrementViews:D}=ae(),{allApplications:V}=se(),m=F(a.id),h=V.find(s=>s.propertyId===a.id),R=!!h||a.is_applied||!1,W=(h==null?void 0:h.status)||a.application_status||null,u=a.view_count||0,k=s=>{s==null||s.stopPropagation(),B&&D(a.id),d?d():x?x(a):I(`/user/dashboard/property/${a.id}`)},E=async s=>{s.stopPropagation(),s.preventDefault();const t=m;y(!0);try{await $(a),N(t?"Property removed from saved":"Property saved successfully!"),g(!0),setTimeout(()=>g(!1),3e3)}catch(i){console.error("Error saving property:",i),N("Failed to save property"),g(!0),setTimeout(()=>g(!1),3e3)}finally{y(!1)}},r=(()=>{var i,n;let s=[];if(Array.isArray(a.images))s=a.images;else if(Array.isArray(a.image_urls))s=a.image_urls;else if(((n=(i=a.media)==null?void 0:i.images)==null?void 0:n.length)>0)s=a.media.images.map(l=>l.url);else if(typeof a.images=="string")try{const l=JSON.parse(a.images);Array.isArray(l)?s=l:typeof l=="string"&&l.startsWith("[")&&(s=JSON.parse(l))}catch{(a.images.startsWith("http")||a.images.startsWith("data:"))&&(s=[a.images])}else if(typeof a.image_urls=="string")try{const l=JSON.parse(a.image_urls);Array.isArray(l)?s=l:typeof l=="string"&&l.startsWith("[")&&(s=JSON.parse(l))}catch{(a.image_urls.startsWith("http")||a.image_urls.startsWith("data:"))&&(s=[a.image_urls])}let t=s.filter(l=>typeof l=="string"&&l.length>5&&!l.includes("[]"));if(t.length===0){const l=a.image||a.image_url||a.thumbnail_url||a.photo||a.main_image;typeof l=="string"&&l.length>5&&!l.includes("[]")&&(t=[l])}return t})(),G=r.length>1,J=s=>{s.stopPropagation(),f(t=>(t+1)%r.length)},O=s=>{s.stopPropagation(),f(t=>(t-1+r.length)%r.length)},q=s=>{var t,i;if(typeof s=="object"&&s!==null&&"amount"in s){const{amount:n,currency:l}=s,P=new Intl.NumberFormat("en-GB",{style:"currency",currency:l||"GBP",maximumFractionDigits:0}).format(n);return a.property_type==="rent"||a.listingType==="rent"||((t=a.type)==null?void 0:t.toLowerCase())==="rent"?`${P}/month`:P}if(typeof s=="number"){const n=`£${s.toLocaleString("en-GB")}`;return a.property_type==="rent"||((i=a.type)==null?void 0:i.toLowerCase())==="rent"?`${n}/month`:n}return s},H=s=>{if(!s)return"";const t=Math.floor((new Date().getTime()-new Date(s).getTime())/(1e3*60*60*24));return t===0?"Listed today":t===1?"Listed 1 day ago":t<7?`Listed ${t} days ago`:t<14?"Listed 1 week ago":`Listed ${Math.floor(t/7)} weeks ago`},U=()=>T?e.jsx("div",{className:"fixed bottom-8 left-1/2 z-[99999] pointer-events-auto transform -translate-x-1/2",children:e.jsxs("div",{className:`flex items-center gap-3 px-6 py-4 rounded-2xl shadow-2xl ${c.includes("removed")||c.includes("Failed")?"bg-gray-900 text-white":"bg-green-500 text-white"}`,children:[c.includes("removed")?e.jsx(_,{size:24,className:"text-white flex-shrink-0"}):c.includes("Failed")?e.jsx("span",{className:"text-xl",children:"⚠️"}):e.jsx(A,{size:24,className:"text-white flex-shrink-0"}),e.jsx("span",{className:"font-bold text-base whitespace-nowrap",children:c}),e.jsx("button",{onClick:s=>{s.stopPropagation(),g(!1)},className:"ml-3 text-white/80 hover:text-white transition-colors text-xl font-bold",children:"×"})]})}):null;return e.jsxs(e.Fragment,{children:[e.jsx(U,{}),e.jsxs("div",{onClick:k,className:"bg-white dark:bg-gray-900 rounded-2xl overflow-hidden shadow-sm hover:shadow-2xl hover:shadow-gray-200/50 dark:hover:shadow-gray-900/50 hover:-translate-y-1.5 transition-all duration-300 group cursor-pointer h-full flex flex-col",children:[e.jsxs("div",{className:"relative h-56 bg-gray-100 dark:bg-gray-800 overflow-hidden flex-shrink-0",children:[r.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r[w],alt:a.title,className:"object-cover group-hover:scale-105 transition-transform duration-500",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"}),G&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:O,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-md",children:e.jsx(te,{size:16,className:"text-gray-700"})}),e.jsx("button",{onClick:J,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-md",children:e.jsx(le,{size:16,className:"text-gray-700"})}),e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5",children:r.map((s,t)=>e.jsx("button",{onClick:i=>{i.stopPropagation(),f(t)},className:`h-1.5 rounded-full transition-all ${t===w?"bg-white w-4":"bg-white/50 w-1.5 hover:bg-white/75"}`},t))})]})]}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-300 to-gray-400 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 font-medium font-manager",children:"No Image"})}),a.type&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:`px-3 py-1.5 rounded-lg text-xs font-bold font-manager shadow-sm ${((p=a.type)==null?void 0:p.toLowerCase())==="rent"?"bg-blue-500 text-white":((S=a.type)==null?void 0:S.toLowerCase())==="sale"?"bg-emerald-500 text-white":"bg-white/95 backdrop-blur-sm text-gray-800"}`,children:a.type==="Sale"?"For Sale":a.type==="Rent"?"For Rent":a.type})}),e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2",children:[e.jsx("button",{onClick:E,disabled:b,className:`p-2 rounded-full backdrop-blur-sm transition-all ${m?"bg-red-500 text-white shadow-lg":"bg-white/90 dark:bg-gray-800/90 text-gray-700 dark:text-gray-200 hover:bg-white dark:hover:bg-gray-800 shadow-sm"} ${b?"opacity-50 cursor-not-allowed":""}`,"aria-label":m?"Remove from saved":"Save property",title:m?"Saved":"Save property",children:b?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(_,{size:16,className:m?"fill-current":""})}),R&&e.jsx("button",{className:"p-2 rounded-full backdrop-blur-sm bg-green-500 text-white shadow-lg",title:`Applied - ${W}`,"aria-label":"Already applied",children:e.jsx(A,{size:16,className:"fill-current"})}),u>0&&e.jsxs("div",{className:"p-2 rounded-full backdrop-blur-sm bg-blue-500 text-white flex items-center gap-1 shadow-lg",title:`Viewed ${u} time${u>1?"s":""}`,children:[e.jsx(oe,{size:14}),e.jsx("span",{className:"text-[10px] font-bold",children:u})]})]}),e.jsx("div",{className:"absolute bottom-3 left-3",children:e.jsx("span",{className:"bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm text-gray-900 dark:text-white px-3 py-1.5 rounded-xl font-bold font-manager text-lg shadow-sm",children:q(a.price)})})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-1 line-clamp-1",children:a.title}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3 flex items-center gap-1",children:[e.jsx(re,{size:14,className:"text-gray-400 dark:text-gray-500 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:typeof a.location=="string"?a.location:a.address||((C=a.location)==null?void 0:C.addressLine1)||((z=a.location)==null?void 0:z.city)||"Location unavailable"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-3",children:[a.bedrooms&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{size:16,className:"text-gray-400 dark:text-gray-500"}),e.jsxs("span",{children:[a.bedrooms," Bed",a.bedrooms>1?"s":""]})]}),a.bathrooms&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{size:16,className:"text-gray-400 dark:text-gray-500"}),e.jsxs("span",{children:[a.bathrooms," Bath",a.bathrooms>1?"s":""]})]}),a.area&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{size:16,className:"text-gray-400 dark:text-gray-500"}),e.jsxs("span",{children:[a.area," sqft"]})]})]}),(a.rating||a.createdAt)&&e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.rating&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[e.jsx(me,{size:14,className:"text-yellow-500 fill-yellow-500"}),e.jsx("span",{className:"text-xs font-bold text-yellow-700 dark:text-yellow-400",children:a.rating}),a.reviews_count&&e.jsxs("span",{className:"text-[10px] text-yellow-600/60 dark:text-yellow-400/60",children:["(",a.reviews_count,")"]})]}),(a.createdAt||a.listedDate)&&e.jsx("span",{className:"text-[10px] text-gray-400 font-medium ml-auto",children:H(a.createdAt||a.listedDate)})]}),a.tags&&Array.isArray(a.tags)&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:a.tags.slice(0,3).map((s,t)=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-[10px] font-bold uppercase tracking-wider rounded-md",children:s},t))}),e.jsxs("div",{className:"mt-auto pt-4 flex gap-2",children:[e.jsx("button",{onClick:k,className:"flex-1 bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white px-4 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 shadow-sm hover:shadow-md",children:"View Details"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),v(!0)},className:"px-4 py-2.5 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl text-sm font-medium transition-all duration-200",children:"Virtual Tour"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),j(!0)},className:"p-2.5 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-xl transition-all duration-200",title:"Share Property",children:e.jsx(xe,{size:16})})]})]})]}),L&&e.jsx(fe,{property:a,onClose:()=>v(!1)}),M&&e.jsx(ne,{property:a,onClose:()=>j(!1)})]})},ze=K.memo(be);export{ze as default};
//# sourceMappingURL=PropertyCard-CPXXlEvn.js.map
