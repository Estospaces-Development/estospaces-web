import{j as e,X as W,aj as X,u as K,r as i,a2 as Y,h as Z,p as ee,ak as ae,a0 as te,q as se,w as le,a3 as z,C as L,a as re}from"./index-Da7XMO_V.js";import{M as ie,S as ne}from"./ShareModal-vEUtzNvG.js";import{E as oe}from"./eye-DZPq23ha.js";import{B as de,a as ce,M as ge}from"./maximize-DSHDdrQv.js";import{S as me}from"./star-CE5u2uMJ.js";import{S as xe}from"./share-2-ClnZqC4G.js";import"./twitter-BFJNeGBu.js";import"./message-circle-DHy2dGbh.js";const he=({property:a,onClose:g})=>{const n=(a==null?void 0:a.virtual_tour_url)||"https://my.matterport.com/show/?m=JGPnGQ6wM5l&play=1";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fadeIn",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl w-full max-w-5xl h-[80vh] flex flex-col overflow-hidden shadow-2xl relative",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between bg-white dark:bg-gray-900",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),"3D Virtual Tour"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a==null?void 0:a.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>window.open(n,"_blank"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors hidden sm:block",title:"Open in new tab",children:e.jsx(ie,{size:20,className:"text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:e.jsx(W,{size:24,className:"text-gray-600 dark:text-gray-300"})})]})]}),e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-black relative group",children:[e.jsx("iframe",{src:n,className:"w-full h-full border-0",allow:"fullscreen",title:`Virtual Tour of ${a==null?void 0:a.title}`,loading:"lazy"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-4 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.jsx("p",{className:"text-white text-center text-sm font-medium",children:"Click and drag to look around • Use arrow keys to move"})})]})]})})},ue=({property:a,onViewDetails:g,onClick:n})=>{var k,p,S,C;const T=K(),[b,u]=i.useState(0),[$,w]=i.useState(!1),[A,v]=i.useState(!1),[f,j]=i.useState(!1),[o,y]=i.useState(""),[I,d]=i.useState(!1),{toggleProperty:M,isPropertySaved:_}=Y(),{user:F}=Z(),{incrementViews:B}=ee(),{allApplications:D}=ae(),c=_(a.id),m=D.find(t=>t.propertyId===a.id),V=!!m||a.is_applied||!1,R=(m==null?void 0:m.status)||a.application_status||null,x=a.view_count||0,N=t=>{t==null||t.stopPropagation(),F&&B(a.id),n?n():g?g(a):T(`/user/dashboard/property/${a.id}`)},E=async t=>{t.stopPropagation(),t.preventDefault();const s=c;j(!0);try{await M(a),y(s?"Property removed from saved":"Property saved successfully!"),d(!0),setTimeout(()=>d(!1),3e3)}catch(l){console.error("Error saving property:",l),y("Failed to save property"),d(!0),setTimeout(()=>d(!1),3e3)}finally{j(!1)}},r=(()=>{const t=a.images||a.image_urls;if(t&&Array.isArray(t)&&t.length>0)return t.slice(0,4);if(typeof a.images=="string"){try{const l=JSON.parse(a.images);if(Array.isArray(l))return l.slice(0,4)}catch{}if(a.images.startsWith("http"))return[a.images]}const s=a.image||a.image_url||a.thumbnail_url||a.photo||a.main_image;return s?[s]:[]})(),G=r.length>1,q=t=>{t.stopPropagation(),u(s=>(s+1)%r.length)},J=t=>{t.stopPropagation(),u(s=>(s-1+r.length)%r.length)},O=t=>{var s,l;if(typeof t=="object"&&t!==null&&"amount"in t){const{amount:h,currency:Q}=t,P=new Intl.NumberFormat("en-GB",{style:"currency",currency:Q||"GBP",maximumFractionDigits:0}).format(h);return a.property_type==="rent"||a.listingType==="rent"||((s=a.type)==null?void 0:s.toLowerCase())==="rent"?`${P}/month`:P}if(typeof t=="number"){const h=`£${t.toLocaleString("en-GB")}`;return a.property_type==="rent"||((l=a.type)==null?void 0:l.toLowerCase())==="rent"?`${h}/month`:h}return t},U=t=>{if(!t)return"";const s=Math.floor((new Date().getTime()-new Date(t).getTime())/(1e3*60*60*24));return s===0?"Listed today":s===1?"Listed 1 day ago":s<7?`Listed ${s} days ago`:s<14?"Listed 1 week ago":`Listed ${Math.floor(s/7)} weeks ago`},H=()=>I?e.jsx("div",{className:"fixed bottom-8 left-1/2 z-[99999] pointer-events-auto transform -translate-x-1/2",children:e.jsxs("div",{className:`flex items-center gap-3 px-6 py-4 rounded-2xl shadow-2xl ${o.includes("removed")||o.includes("Failed")?"bg-gray-900 text-white":"bg-green-500 text-white"}`,children:[o.includes("removed")?e.jsx(z,{size:24,className:"text-white flex-shrink-0"}):o.includes("Failed")?e.jsx("span",{className:"text-xl",children:"⚠️"}):e.jsx(L,{size:24,className:"text-white flex-shrink-0"}),e.jsx("span",{className:"font-bold text-base whitespace-nowrap",children:o}),e.jsx("button",{onClick:t=>{t.stopPropagation(),d(!1)},className:"ml-3 text-white/80 hover:text-white transition-colors text-xl font-bold",children:"×"})]})}):null;return e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsxs("div",{onClick:N,className:"bg-white dark:bg-gray-900 rounded-2xl overflow-hidden shadow-sm hover:shadow-2xl hover:shadow-gray-200/50 dark:hover:shadow-gray-900/50 hover:-translate-y-1.5 transition-all duration-300 group cursor-pointer h-full flex flex-col",children:[e.jsxs("div",{className:"relative h-56 bg-gray-100 dark:bg-gray-800 overflow-hidden flex-shrink-0",children:[r.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r[b],alt:a.title,className:"object-cover group-hover:scale-105 transition-transform duration-500",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"}),G&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:J,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-md",children:e.jsx(te,{size:16,className:"text-gray-700"})}),e.jsx("button",{onClick:q,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-md",children:e.jsx(se,{size:16,className:"text-gray-700"})}),e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5",children:r.map((t,s)=>e.jsx("button",{onClick:l=>{l.stopPropagation(),u(s)},className:`h-1.5 rounded-full transition-all ${s===b?"bg-white w-4":"bg-white/50 w-1.5 hover:bg-white/75"}`},s))})]})]}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-300 to-gray-400 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 font-medium font-manager",children:"No Image"})}),a.type&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:`px-3 py-1.5 rounded-lg text-xs font-bold font-manager shadow-sm ${((k=a.type)==null?void 0:k.toLowerCase())==="rent"?"bg-blue-500 text-white":((p=a.type)==null?void 0:p.toLowerCase())==="sale"?"bg-emerald-500 text-white":"bg-white/95 backdrop-blur-sm text-gray-800"}`,children:a.type==="Sale"?"For Sale":a.type==="Rent"?"For Rent":a.type})}),e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2",children:[e.jsx("button",{onClick:E,disabled:f,className:`p-2 rounded-full backdrop-blur-sm transition-all ${c?"bg-red-500 text-white shadow-lg":"bg-white/90 dark:bg-gray-800/90 text-gray-700 dark:text-gray-200 hover:bg-white dark:hover:bg-gray-800 shadow-sm"} ${f?"opacity-50 cursor-not-allowed":""}`,"aria-label":c?"Remove from saved":"Save property",title:c?"Saved":"Save property",children:f?e.jsx(le,{size:16,className:"animate-spin"}):e.jsx(z,{size:16,className:c?"fill-current":""})}),V&&e.jsx("button",{className:"p-2 rounded-full backdrop-blur-sm bg-green-500 text-white shadow-lg",title:`Applied - ${R}`,"aria-label":"Already applied",children:e.jsx(L,{size:16,className:"fill-current"})}),x>0&&e.jsxs("div",{className:"p-2 rounded-full backdrop-blur-sm bg-blue-500 text-white flex items-center gap-1 shadow-lg",title:`Viewed ${x} time${x>1?"s":""}`,children:[e.jsx(oe,{size:14}),e.jsx("span",{className:"text-[10px] font-bold",children:x})]})]}),e.jsx("div",{className:"absolute bottom-3 left-3",children:e.jsx("span",{className:"bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm text-gray-900 dark:text-white px-3 py-1.5 rounded-xl font-bold font-manager text-lg shadow-sm",children:O(a.price)})})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-1 line-clamp-1",children:a.title}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3 flex items-center gap-1",children:[e.jsx(re,{size:14,className:"text-gray-400 dark:text-gray-500 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:typeof a.location=="string"?a.location:a.address||((S=a.location)==null?void 0:S.addressLine1)||((C=a.location)==null?void 0:C.city)||"Location unavailable"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-3",children:[a.bedrooms&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{size:16,className:"text-gray-400 dark:text-gray-500"}),e.jsxs("span",{children:[a.bedrooms," Bed",a.bedrooms>1?"s":""]})]}),a.bathrooms&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{size:16,className:"text-gray-400 dark:text-gray-500"}),e.jsxs("span",{children:[a.bathrooms," Bath",a.bathrooms>1?"s":""]})]}),a.area&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{size:16,className:"text-gray-400 dark:text-gray-500"}),e.jsxs("span",{children:[a.area," sqft"]})]})]}),(a.rating||a.createdAt)&&e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.rating&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[e.jsx(me,{size:14,className:"text-yellow-500 fill-yellow-500"}),e.jsx("span",{className:"text-xs font-bold text-yellow-700 dark:text-yellow-400",children:a.rating}),a.reviews_count&&e.jsxs("span",{className:"text-[10px] text-yellow-600/60 dark:text-yellow-400/60",children:["(",a.reviews_count,")"]})]}),(a.createdAt||a.listedDate)&&e.jsx("span",{className:"text-[10px] text-gray-400 font-medium ml-auto",children:U(a.createdAt||a.listedDate)})]}),a.tags&&Array.isArray(a.tags)&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:a.tags.slice(0,3).map((t,s)=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-[10px] font-bold uppercase tracking-wider rounded-md",children:t},s))}),e.jsxs("div",{className:"mt-auto pt-4 flex gap-2",children:[e.jsx("button",{onClick:N,className:"flex-1 bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white px-4 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 shadow-sm hover:shadow-md",children:"View Details"}),e.jsx("button",{onClick:t=>{t.stopPropagation(),w(!0)},className:"px-4 py-2.5 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl text-sm font-medium transition-all duration-200",children:"Virtual Tour"}),e.jsx("button",{onClick:t=>{t.stopPropagation(),v(!0)},className:"p-2.5 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-xl transition-all duration-200",title:"Share Property",children:e.jsx(xe,{size:16})})]})]})]}),$&&e.jsx(he,{property:a,onClose:()=>w(!1)}),A&&e.jsx(ne,{property:a,onClose:()=>v(!1)})]})},Se=X.memo(ue);export{Se as default};
//# sourceMappingURL=PropertyCard-DKWCqJd3.js.map
